var g=(C,x,r)=>new Promise((u,o)=>{var f=n=>{try{p(r.next(n))}catch(h){o(h)}},w=n=>{try{p(r.throw(n))}catch(h){o(h)}},p=n=>n.done?u(n.value):Promise.resolve(n.value).then(f,w);p((r=r.apply(C,x)).next())});import{_ as M}from"./AppSidebar.e6135d3f.js";import{u as U,n as _,r as q,c as k,F as R,B as G,o as c,f as d,p as a,g as v,M as J,S as Q,T as A,x as D,Q as S,W as I,V as y,w as N,v as W,q as i,j as X,X as Y,N as V,Y as Z,Z as F,y as H,$ as K,a0 as ee}from"./vendor.df9a4b93.js";import"./index.ba59bafc.js";const te={class:"flex h-screen w-screen"},se={class:"h-full border-r bg-gray-50"},ae={class:"h-full w-full flex flex-col overflow-auto"},oe={class:"flex-1 flex flex-col h-full"},le={class:"flex mt-4 mb-4 px-5 justify-between"},ne={class:"flex"},re={class:"ml-6 mt-1"},ie={key:0,class:"flex-1 flex flex-col px-5 overflow-auto"},ce={key:0},de={key:1},ue={class:"text-black text-base",style:{"max-width":"170px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",display:"block"}},pe={key:2},me={class:"font-small text-gray-700 text-base",style:{"max-width":"170px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",display:"block"}},fe={class:"w-full mt-2"},he={class:"flex justify-between items-center"},be={__name:"Purchase",setup(C){const x=U(),r=_([]),u=_([]),o=q({}),f=_(20),w=_(""),p=_(""),n=k({url:"go1_vendor.apidata.get_test",cache:["true"]});n.fetch();const h=n,l=k({url:"go1_vendor.apidata.get_purchaseorder",params:{field_filters:JSON.stringify(o)},method:"GET"}),O=k({url:"go1_vendor.api.get_purchase",method:"GET"}),$=()=>g(this,null,function*(){const s=(yield O.fetch()).fields;r.value=[],u.value=[],u.value.push({fieldname:"name",fieldtype:"Data",options:null,label:"ID"}),r.value.push({label:"Name",key:"name",width:2},{label:"Status",key:"status",width:1}),s.forEach(t=>{if(t.in_list_view&&r.value.push({label:t.label,key:t.fieldname,width:t.width}),t.in_standard_filter){if(h.data&&t.fieldname==="supplier")return;u.value.push(t)}})}),j=e=>{e&&e.name?x.push({name:"Request Quotation Details",params:{id:e.name}}):console.error("Row data is invalid:",e)};R(f,e=>{l.limit=e,l.fetch()}),R(o,e=>{l.params={field_filters:JSON.stringify(o)},l.fetch();for(let s in e)(e[s]===null||e[s]==="")&&delete e[s];console.log("data",o)},{deep:!0});const E=e=>{switch(e){case"Draft":return{theme:"red"};case"Overdue":return{theme:"blue"};case"Cancelled":return{theme:"green"};case"Return":return{theme:"orange"};default:return{theme:"gray"}}},T=()=>{Object.keys(o).forEach(e=>{delete o[e]}),l.fetch()},z=e=>({Select:K,Color:y,Date:ee,Link:y,TextEditor:y,Data:y,ReadOnly:"ReadOnlyComponent"})[e.fieldtype]||y,P=e=>({Select:{options:B(e.options)||[],placeholder:e.label},Link:{size:"sm",variant:"subtle",type:"select",placeholder:e.label,options:e.fieldname=="supplier"?w.value:p.value||[]},Date:{size:"sm",placeholder:e.label},Data:{size:"sm",variant:"subtle",placeholder:e.label},TextEditor:{placeholder:e.label,variant:"subtle"}})[e.fieldtype]||{},B=e=>e?e.split(`
`).map(s=>({label:s,value:s})):[],L=()=>g(this,null,function*(){try{const e=yield fetch('/api/resource/Supplier?fields=["supplier_name"]'),s=yield fetch('/api/resource/Company?fields=["company_name"]');if(!e.ok)throw new Error("Network response was not ok");const t=yield e.json(),b=yield s.json();w.value=t.data.map(m=>m.supplier_name)||[],p.value=b.data.map(m=>m.company_name)||[]}catch(e){console.error("Error fetching priorities:",e)}});return G(()=>g(this,null,function*(){yield L(),$(),l.fetch()})),(e,s)=>(c(),d("div",te,[a("div",se,[v(M)]),a("div",ae,[a("div",oe,[s[3]||(s[3]=a("div",{class:"mb-2 border-b p-4"},[a("span",null,"Purchase Orders")],-1)),J(e.$slots,"default"),a("div",le,[a("div",ne,[(c(!0),d(Q,null,A(u.value,t=>(c(),d("div",{class:"p-1 w-36",key:t.fieldname},[(c(),D(I(z(t)),S({ref_for:!0},P(t),{modelValue:o[t.fieldname],"onUpdate:modelValue":b=>o[t.fieldname]=b}),null,16,["modelValue","onUpdate:modelValue"]))]))),128))]),a("div",re,[v(i(X),{variant:"subtle",theme:"gray",size:"sm",onClick:T},{default:N(()=>s[2]||(s[2]=[W(" Reset ")])),_:1})])]),i(l).data?(c(),d("div",ie,[v(i(Z),{class:"flex-1 overflow-auto",columns:r.value,rows:i(l).data,options:{getRowRoute:t=>({name:"Purchase Detail",params:{id:t.name}}),selectable:!0,showTooltip:!0,resizeColumn:!0,emptyState:{title:"No records found",description:"Create a new record to get started",button:{label:"New Record",variant:"solid",onClick:()=>console.log("New Record")}}},"row-key":"name",onRowClick:j},{cell:N(({item:t,row:b,column:m})=>[m.key==="status"?(c(),d("div",ce,[v(i(Y),S(E(t),{size:"sm",label:t}),null,16,["label"])])):m.key==="naming_series"?(c(),d("div",de,[a("span",ue,V(t),1)])):(c(),d("div",pe,[a("span",me,V(t),1)]))]),_:1},8,["columns","rows","options"]),a("div",fe,[a("div",he,[v(i(F),{modelValue:f.value,options:{rowCount:i(l).data.length,totalCount:i(l).data.length},"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),onLoadMore:s[1]||(s[1]=t=>i(l).fetch()),class:"w-full"},null,8,["modelValue","options"])])])])):H("",!0)])])]))}};export{be as default};
